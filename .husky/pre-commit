CHANGED_SERVICES=$(git diff --cached --name-only | grep '^services/' | cut -d/ -f2 | uniq)

if [ ${#CHANGED_SERVICES[@]} -eq 0 ]; then
    echo "> No services to test."
else
  echo "> Starting tests"
fi

cd services

for service in $CHANGED_SERVICES; do
  cd $service
  echo "> Starting $service's tests."
  (bun test || {
      echo "âŒ Tests failed in $service"
      exit 1
    })

  cd ..
  
done
